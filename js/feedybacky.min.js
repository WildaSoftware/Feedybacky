const feedybackyScriptName="feedybacky.min.js",checkboxVisibleOption="visible",checkboxAutoEnableOption="autoEnable",checkboxAutoDisableOption="autoDisable",checkboxOptions=[checkboxVisibleOption,checkboxAutoEnableOption,"autoDisable"];class FeedybackyPayload{add(e,t){this[e]=t}}class Feedybacky{constructor(e,t){this.params=t,this.basePath=null,this.consoleErrors=[],this.importDependencies(),this.container=document.getElementById(e),this.extraInfoFunction=t.extraInfo||null,this.beforeSubmitFunction=t.beforeSubmit||null,this.prefix=t.prefix||null,this.onSubmitUrlSuccess=t.onSubmitUrlSuccess||null,this.onSubmitUrlError=t.onSubmitUrlError||null,this.params.screenshotField&&checkboxOptions.includes(this.params.screenshotField)||(this.params.screenshotField=checkboxVisibleOption),this.params.metadataField&&checkboxOptions.includes(this.params.metadataField)||(this.params.metadataField=checkboxVisibleOption),"boolean"!=typeof this.params.alertAfterRequest&&(this.params.alertAfterRequest=!0),this.params.emailField=this.params.emailField||!1,this.loadMessages().then(()=>{this.initMinifiedContainer(),this.initExtendedContainer(),this.initAlertContainer(),document.getElementById("feedybacky-container-hide-button").addEventListener("click",e=>{this.showMinimalContainer()}),this.params.onSubmit&&document.getElementById("feedybacky-form").addEventListener("submit",this.params.onSubmit),this.params.onSubmitUrl&&document.getElementById("feedybacky-form").addEventListener("submit",e=>{e.preventDefault(),this.clearErrors(),this.validateForm()&&(this.prepareAndSendRequest(),this.showMinimalContainer())}),document.getElementById("feedybacky-form-description").addEventListener("keydown",e=>{e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),document.getElementById("feedybacky-form-submit-button").click())}),document.getElementById("feedybacky-alert-container").addEventListener("click",e=>{document.getElementById(e.srcElement.id).style.display="none"}),window.onerror=((e,t,a)=>(this.consoleErrors.push(`${e} ${t} ${a}`),!1))})}async loadMessages(){this.defaultVars={language:"en",texts:{}},this.params.language=this.params.language||this.defaultVars.language,this.defaultVars.texts=await(async()=>{let e=null;if(this.basePath)await this.loadJsonFile(`${this.basePath}/i18n/${this.params.language}.json`,t=>{e=t},async t=>{console.warn(`Feedybacky cannot load default language pack for ${this.params.language}. The default language pack will be loaded.`),await this.loadJsonFile(`${this.basePath}/i18n/${this.defaultVars.language}.json`,t=>{e=t})});else try{e=require(`../i18n/${this.params.language}.json`)}catch(t){console.warn(`Feedybacky cannot load default language pack for ${this.params.language}. The default language pack will be loaded.`),e=require(`../i18n/${this.defaultVars.language}.json`)}return e})(),this.params.texts=this.params.texts||{},this.params.texts.powered=this.params.texts.hasOwnProperty("powered")?this.params.texts.powered:`${this.defaultVars.texts.powered} <a href="http://wildasoftware.pl/" target="_blank">Wilda Software</a>`;for(const[e,t]of Object.entries(this.defaultVars.texts))this.params.texts[e]=this.params.texts[e]||t}initMinifiedContainer(){this.minifiedContainer=document.createElement("div"),this.minifiedContainer.id="feedybacky-container-minified",this.minifiedContainer.title=this.params.texts.tooltip,this.minifiedContainer.innerHTML="<div></div>",this.minifiedContainer.setAttribute("data-html2canvas-ignore",!0),this.container.appendChild(this.minifiedContainer),this.minifiedContainer.addEventListener("click",e=>{this.showExtendedContainer()})}initExtendedContainer(){this.extendedContainer=document.createElement("div"),this.extendedContainer.id="feedybacky-container-extended",this.extendedContainer.setAttribute("data-html2canvas-ignore",!0),this.container.appendChild(this.extendedContainer);let e="";this.params.emailField&&(e=`\n        \t\t<div id="feedybacky-container-email-description">${this.params.texts.email}</div>\n        \t\t<input id="feedybacky-form-email" form="feedybacky-form" name="email" aria-required="true"/>\n        \t\t<div id="feedybacky-form-email-error-message" class="feedybacky-error-message"></div>\n        \t`);let t="";this.params.screenshotField==checkboxVisibleOption&&(t=`<label><input type="checkbox" id="feedybacky-form-screenshot-allowed" checked="true"/>${this.params.texts.screenshot}</label>`);let a="";this.params.metadataField==checkboxVisibleOption&&(a=`<label><input type="checkbox" id="feedybacky-form-metadata-allowed" checked="true"/>${this.params.texts.metadata}</label>`);let i="";(t||a)&&(i=`<div id="feedybacky-container-additional-description">${this.params.texts.additionalDataInformation}</div>`);const n=`\n\t\t\t<div id="feedybacky-container-title">${this.params.texts.title}</div>\n\t\t\t<div id="feedybacky-container-hide-button" aria-label="Zamknij">\n\t\t\t\t<span aria-hidden="true">&times;</span>\n\t\t\t</div>\n\t\t\t<div id="feedybacky-description">\n\t\t\t\t${this.params.texts.description}\n\t\t\t</div>\n\t\t\t<form id="feedybacky-form">\n\t\t\t\t<textarea maxlength="1000" id="feedybacky-form-description" form="feedybacky-form" name="description" aria-required="true"></textarea>\n\t\t\t\t<div id="feedybacky-form-description-error-message" class="feedybacky-error-message"></div>\n\t\t\t\t${e}\n\t\t\t\t${i}\n\t\t\t\t${t}\n\t\t\t\t${a}\n\t\t\t\t<button id="feedybacky-form-submit-button" type="submit">${this.params.texts.send}</button>\n\t\t\t</form>\n\t\t\t<div id="feedybacky-container-powered">\n\t\t\t\t${this.params.texts.powered}\n\t\t\t</div>\n\t\t`;this.extendedContainer.innerHTML=n}initAlertContainer(){this.alertContainer=document.createElement("div"),this.alertContainer.id="feedybacky-alert-container",this.alertContainer.setAttribute("data-html2canvas-ignore",!0),this.container.appendChild(this.alertContainer)}clearErrors(){let e=document.getElementsByClassName("feedybacky-error-message");for(let t=0;t<e.length;++t)e[t].innerText=""}validateForm(){let e=document.getElementById("feedybacky-form-description"),t=document.getElementById("feedybacky-form-email"),a=!0;return e.value||(document.getElementById("feedybacky-form-description-error-message").innerText=this.params.texts.descriptionErrorEmpty,a=!1),t&&!t.value&&(document.getElementById("feedybacky-form-email-error-message").innerText=this.params.texts.emailErrorEmpty,a=!1),a}prepareAndSendRequest(){let e=document.getElementById("feedybacky-form-description"),t=document.getElementById("feedybacky-form-email"),a=new FeedybackyPayload;a.message=e.value,a.timestamp=new Date,a.url=window.location.href,a.errors=this.consoleErrors,t&&(a.email=t.value),this.prefix&&(a.prefix=this.prefix);let i=document.getElementById("feedybacky-form-screenshot-allowed"),n=document.getElementById("feedybacky-form-metadata-allowed");const s=i?i.checked:this.params.screenshotField==checkboxAutoEnableOption;(n?n.checked:this.params.metadataField==checkboxAutoEnableOption)&&(a.agent=navigator.userAgent,a.cookies=document.cookie,a.platform=navigator.platform,a.screenSize=`${screen.width}x${screen.height}`,a.availableScreenSize=`${screen.availWidth}x${screen.availHeight}`,a.innerSize=`${window.innerWidth}x${window.innerHeight}`,a.colorDepth=screen.colorDepth,screen.orientation&&(a.orientation=screen.orientation.type)),this.extraInfoFunction&&(a.extraInfo=this.extraInfoFunction()),s?html2canvas(document.body,{onrendered:e=>{a.image=e.toDataURL("image/png"),this.handleBeforeSubmitCallback(a),this.sendPostRequest(this.params.onSubmitUrl,a)}}):(this.handleBeforeSubmitCallback(a),this.sendPostRequest(this.params.onSubmitUrl,a)),e.value=""}sendPostRequest(e,t){fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>{200==e.status||201==e.status?(this.showAlertContainer(!0),this.onSubmitUrlSuccess&&e.text().then(t=>{this.onSubmitUrlSuccess(e.status,t)})):(this.showAlertContainer(!1),this.onSubmitUrlError&&e.text().then(t=>{this.onSubmitUrlError(e.status,t)}))}).catch(e=>{this.showAlertContainer(!1,e)})}handleBeforeSubmitCallback(e){this.beforeSubmitFunction&&this.beforeSubmitFunction(e)}showMinimalContainer(){this.extendedContainer.style.display="none",this.minifiedContainer.style.display="block"}showExtendedContainer(){this.minifiedContainer.style.display="none",this.extendedContainer.style.display="block",document.getElementById("feedybacky-form-description").focus()}showAlertContainer(e,t){this.params.alertAfterRequest&&(this.alertContainer.classList="",e?(this.alertContainer.innerHTML=this.params.texts.requestSuccess,this.alertContainer.classList="feedybacky-alert-container-success"):(this.alertContainer.innerHTML=this.params.texts.requestFail,this.alertContainer.innerHTML+=" "+(this.defaultVars.texts["error"+t]||"error "+t),this.alertContainer.classList="feedybacky-alert-container-failure"),this.alertContainer.style.display="inline-block",setTimeout(()=>{this.alertContainer.style.display="none"},3e3))}importDependencies(){const e=document.getElementsByTagName("script");for(let t=e.length-1;t>=0;--t){let a=e[t].src,i=(a.length,a.split("/"));if(i[i.length-1].includes(feedybackyScriptName)){this.basePath=i.slice(0,-2).join("/");break}}this.basePath&&(this.importCssFile(`${this.basePath}/css/feedybacky.min.css`),this.importJsFile(`${this.basePath}/dependencies/html2canvas/html2canvas.min.js`))}importCssFile(e){const t=document.getElementsByTagName("head")[0];let a=document.createElement("link");a.href=e,a.type="text/css",a.rel="stylesheet",t.append(a)}importJsFile(e){const t=document.getElementsByTagName("body")[0];let a=document.createElement("script");a.src=e,a.type="text/javascript",t.append(a)}async loadJsonFile(e,t,a){try{t(await(await fetch(e)).json())}catch(e){a&&a(e)}}}"undefined"!=typeof module&&(module.exports.FeedybackyPayload=FeedybackyPayload,module.exports.Feedybacky=Feedybacky);